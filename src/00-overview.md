---
title: 概述
publishDate: 2017-2-7
---
# 概述

# 概念说明 {#a00-h00}

## 客户端
客户端是数量最大的部署单元，分布在不同的机场外站柜台, 无法通过 VPN 远程访问操作, 必须人工现场维护。因此，实现这部分的自动安装和更新机制非常必要，可极大的减少实施工作量。客户端需要实现的功能主要是连接硬件设备，和作为浏览器端接收外站的HTTP服务。因此，这部分是不包括业务功能的，保持功能的单一性和稳定性是首要目标。

## 外站

技术实现最复杂的模块，同时作为外站HTTP服务端，rpc客户端，客户端自动更新服务端运行的一个应用程序。由于部署在外站服务器，因此，对硬件配置要求不宜太高，并且要保持实施操作简单，不宜使用集群。

## 中心

离港的所有核心业务处理在这里完成，同时为所有外站节点提供服务。为提升负载能力和吞吐量，预计二期考虑做服务拆分，横向扩展。

可直接在中心完成实时的数据控制，状态监控。极大的突破了老系统的业务限制。


# 模块说明 {#a00-h01}

v9系统分为 8 个模块

    +--------------+       +--------------+
    |              |       |              |
    | dcs_launcher +-------+ dcs_terminal |
    |              |       |              |
    +--------------+       +---+---+------+
                               |   |
    +-----------+              |   | +------------+
    |           +--------------+   +-+            |
    | site_core |                    | center_ser |
    |           |                    |            |
    +----+--+---+                    +-+---+--+---+
         |  |                          |   |  |
         |  |   +------------+         |   |  |
         |  |   |            |         |   |  |
         |  +---> dcs_static <---------+   |  |
         |      |            |             |  |
         |      +------------+             |  |
         |                                 |  |
         |       +----------+              |  |
         |       |          |              |  |
         +-------> dcs_core <--------------+  |
                 |          |                 |
                 +----+-----+                 |
                      |                       |
                 +----+----+         +--------+---+
                 |         |         |            |
                 | dcs_rpc +---------+ center_web |
                 |         |         |            |
                 +---------+         +------------+


- dcs-launcher, 客户端启动器, 实现自动更新
- dcs-terminal, 柜台客户端, 由 launcher 加载运行, 也可独立运行, 加载设备驱动, 内嵌浏览器交互界面
- site-core, 外站服务, 为当前外站所有柜台提供http服务
- center-server, 中心服务, 为所有外站提供rpc服务, 同时也可为国际外站柜台提供http服务
- dcs-static, 静态资源, 中心和外站http服务共用, 包括css, js, image, deploy
- dcs-core, 核心模块, 包括基础功能, 中心和外站共享的实体类和服务层
- dcs-rpc, 通信模块, 封将了基于netty和protobuf的通信服务层
- center-web, 中心监控, 提供监控服务, 对互联网开放

# 客户端启动器 dcs-launcher {#a00-h02}

客户端启动器是一个 java 桌面应用, 主要功能是更新和启动客户端程序 dcs-terminal

# 柜台客户端 dcs-terminal {#a00-h03}

客户端模块是一个 java 桌面应用, 主要功能有 2 个,

内嵌浏览器内核, 加载 html 等静态资源, 实现操作界面 UI 的交互

将驱动等操作的 api 翻译成 js 可调用的 api, 并开放给操作界面 UI 调用

主要涉及的 api 类型如下

- 操作本地配置文件
- 打印图片
- 护照键盘读写操作
- 登机牌打印机读写操作
- 行李牌打印机读写操作
- 登机牌扫描器读写操作
- 身份证扫描器读写操作
- 小票打印机读写操作
- 登机牌TSP打印机读写操作
- 播放声音文件
- 调用本地 cmd 控制台

# 外站服务 site-core {#a00-h04}

外站服务模块是一个web应用, 对外提供业务功能相关 http 服务. 此外, 还包括如下功能点实现

- NetworkControl, 外站网络监控
- ClientLogSyncCenter, 日志同步
- DownloadDataService, 下载数据服务
- ClientUpdater, 离线数据主动推送到中心
- BaggageSiteService, 离线获取外站行李号

# 中心服务 center-server {#a00-h05}

中心服务模块是一个 web 应用, 对外提供业务功能 http 和 rpc 服务. 此外, 还包括如下功能点实现

- CqSaleToDcsSale, 销售数据 到 DCS销售数据
- DataSaleToCenter, DCS销售数据转离港数据
- BackUpdateSaleTask, 回传数据到销售库
- SyncDataServiceImpl, 同步数据服务
- NetStatusRpcImpl, 网络状态服务
- PingRpcImpl, ping 服务
- QrOfflineRpcImpl, 二维码离线数据服务
- UpdaterInterface, 离线数据合并

# 静态资源 dcs-static {#a00-h06}

静态资源主要包括 4 类 web 资源, 由中心服务 center-server 和外站服务 site-core 共用

客户端每次启动, 静态资源最多加载一次, GZIP压缩后, 总的大小控制在 100kb 以内

- deploy, 客户端的发布包
- html, 客户端页面资源
- js, 客户端 javascript 页面脚本资源
- css, 客户端样式资源
- image, 客户端图片资源

# 核心模块 dcs-core {#a00-h07}

根据机场网络条件的不同, 柜台有 2 种调用服务的方式

    +------------+             +---------------+
    |            |   http      |               |
    | terminal_a +-------------+ center_server +--------------+
    |            |             |               |              |
    +------------+             +-----+---------+              |
                                     |                        |
                                     |                  +-----v----+
                                 rpc |                  |          |
                                     |                  | dcs_core |
                                     |                  |          |
                                     |                  +-----^----+
    +------------+             +-----+-----+                  |
    |            |   http      |           |                  |
    | terminal_b +-------------+ site_core +------------------+
    |            |             |           |
    +------------+             +-----------+

- 网络稳定情况下, 直连中心服务, 完成业务操作, 主要适用于国际机场, 没有机场服务器
- 网络不佳的情况, 连接外站服务, 通过rpc与中心服务通迅, 主要适用于国内机场, 有机场服务器



核心模块由外站和中心服务共享, 包含所有的核心业务功能实现, 分层结构如下

- cmd 层, 实现 http 服务
- service 层, 实现核心业务处理
- entity 层, 所有的业务实体类
- rpc 层, 实现 rpc 服务

# 通信模块 dcs-rpc {#a00-h08}

dcs-rpc模块基于netty和protobuf, 分层结构如下

与thrift, hession, grpc等开源方案相比, 我们采用的方式更轻量, 定制更方便, 性能也更好

    +--------------------+                            +--------------------+
    |                    |                            |                    |
    | DcsRpcClientHolder |                            | DcsRpcServerHolder |
    |                    |                            |                    |
    +-----+--------------+                            +--------------+-----+
          |                                                          |
    +-----+-----------+                             +----------------+-----+
    |                 |                             |                      |
    | RpcServiceProxy |       +------------+        | ServerChannelHandler |
    |                 +-------+            +--------+                      |
    +-----+-----------+       | RpcService |        +----------------+-----+
          |                   |            |                         |
          |                   +---+----+---+                         |
    +-----+---+                   |    |                        +----+-----+
    |         +-------------------+    +------------------------+          |
    | Request |                                                 | Response |
    |         +-------------------+    +------------------------+          |
    +-----+---+                   |    |                        +----+-----+
          |                      ++----+-+                           |
          |                      |       |                           |
    +-----+------------+         | Proto |              +------------+-----+
    |                  +---------+       +--------------+                  |
    | protobuf message |         +-------+              | protobuf message |
    |                  |                                |                  |
    +-----+------------+                                +------------+-----+
          |                                                          |
    +-----+--------+                                        +--------+-----+
    |              |                                        |              |
    | netty client +----------------------------------------+ netty server |
    |              |                                        |              |
    +--------------+                                        +--------------+

# 中心监控 center-web {#a00-h09}

中心监控模块是一个 web 应用, 对外提供 http 服务, 主要包括 v9 相关的后台监控和数据维护服务

主要分层结构如下

- controller 层, 分发请求
- service 层, 实现业务处理
- dao 层, 封装数据库操作
- entity 层, 业务实体

